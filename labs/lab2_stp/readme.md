# Избыточность локальных сетей. STP
____
## Задание:  
Часть 1. Создание сети и настройка основных параметров устройства  
Часть 2. Выбор корневого моста  
Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов  
Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов  
___
### Часть 1
В соответствии с требованием задания была построена сеть:  
![scheme](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/lab2_topology.png)  
Были выполнена настройка основных параметров устройств (S1,S2,S3):
- Отключен поиск DNS `no ip domain-lookup`  
- Назначено имя устройства `hostname R1`  
- Назначен требуемый пароль на EXEC, ENABLE, консоль и линии VTY  
`enable secret class`  
`line console 0`  
`password cisco`  
`login`  
`exit`  
`line vty 0 4`  
`password cisco`  
`login`  
- Зашифрованны все пароли `service password-encryption`
- Установлен баннер `banner motd ^C Unauthorized access is strictly prohibited and prosecuted to the full extent of the law.^C`  
- Настроен logging synchronous для консольного канала  
- Итерфейс управления был создан соответствующей командой `interface Vlan1` 
- Также устройствам были выданы IP - адреса в соответствии с заданием  
 #### Результаты проверки связи между устройствами
 Проверка связи от S1 к S2,S3  
 ![S1](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/S1.png)  
 _____
 Проверка связи от S2 к S3  
 ![S2](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/S2.png)  
 _____
 ### Часть 2
 Для выполнения данного задания были предварительно выполнены следующие действия:  
 - Отключены все порты на коммутаторах
 - Все подключенные порты настроены в качестве транковых
 - Затем включены порты e0/1 и e0/3  
 В результате выше перечисленных действий на коммутаторах вывод команды `show spanning-tree` имеет следующий вид:  
 ![1_shstp](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/1_shstp.png)  
 Исходя из этих данных заполнена следующая схема:  
 ![1_top](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/1_top.png)  
> По условию задания порты e0/0  и e0/2 отключены на всех коммутаторах
#### На основании данных полученных в этом задании можно ответить на предложенные вопросы:
- Какой коммутатор является корневым мостом?  
`S1`
- Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?  
`Так как имеет наименьшее значение MAC адреса при равных значениях Bridge Priority`  
-Какие порты на коммутаторе являются корневыми портами?  
`S3 e0/3, S2 e0/1`
- Какие порты на коммутаторе являются назначенными портами?  
`S1 e0/1, S1 e0/3, S2 e0/3`
- Какой порт отображается в качестве альтернативного и в настоящее время заблокирован?  
`S3 e0/1`
- Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?
`Заблокирован порт S3 e0/1 а не S2 e0/3 между не корневыми мостами S2 и S3 на основании того что BridgeID S3 больше чем BridgeID S2 при прочих равных параметрах, поэтому со стороны S2 порт является назначенным а со стороны S3 заблокированным`  
____
### Часть 3
При текущей конфигурации коммутатором с заблокированным портом является коммутатор S3, второй активный порт этого коммутатора является корневым.
Согласно заданию необходимо уменьшить стоимость порта выбранного корневым с помощью команды `spanning-tree cost 18`.  
После внесенных измениях в конфигурацию коммутатора вывод команды `show spanning-tree` для коммутаторов не являющимся корневыми стал таким:  
 ![2_shstp](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/2_shstp.png)  
После ввода команды на уменьшение стоимости порта протокол STP заменяет ранее заблокированный порт на назначенный порт и блокирует порт, так как изменилась стоимость пути до корневого коммутатора.  
В данной конфигурации стоимость пути от коммутатора S3 до S1 стала меньше чем от S2 до S1. Поэтому между коммутаторами S2 и S3 порт на коммутаторе S2 стал заблокированным (До этого между ними заблокировн был порт на стороне S3 так как стоимость пути была одинакова а BridgeID S3 был больше).
____
### Часть 4
В данной части необходимо включить ранее выключенные порты и посмотреть как STP будет назначать порты исходя из приоритета портов.  
Вывод команды `show spanning-tree` после включения ранее выключенных портов:
 ![3_shstp](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/Screnshots/S3_shstp.png)  
 Корневыми стали порты с наименьшим значение номера порта при одинаковом значении приоритета подключенные к корневому коммутатору.  
Вопросы к данному разделу:  
- Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста? `S2 e0/0, S3 e0/2`  
- Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах? `Эти порты имеют наименьшее значение номера порта при одинаковом значении приоритета среди подключенных к корневому коммутатору`
_______
В данной работе также приведены вопросы для повторения:
Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?  
`Стоимость пути`  
Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?  
`Приоритет`  
Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?  
`Порт, имеющий наименьший номер`
_____
# Конфигурации устройств
- [Конфигурация S1](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/config/S1)  
- [Конфигурация S2](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/config/S2)  
- [Конфигурация S3](https://github.com/Alnor23/OTUS_NETWORK/blob/main/labs/lab2_stp/config/S3) 

 
